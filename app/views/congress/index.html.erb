<style type="text/css">
div#congress-display {
  background: white;
}
#congress-display > div {
  color: #555555;
}
div.congress-header {
  font-family: "Bebas Neue";
  font-size: 24px;
  color: black;
}

#house-bills, #senate-bills {
  height: 480px;
  display: inline-block;
  border: 1px solid black;
  overflow-y: scroll;
  overflow-x: hidden;
  margin-bottom: 12px;
}

#house-bills-wrapper {
  width: 50%;
  float: left;
}

#senate-bills-wrapper {
  width: 50%;
  float: right;
}

.bill {
  padding: .5em 0;
}

.bill > div {
  padding: 0 1em;
  line-height: 1em;
}

.bill-number {
  display: inline-block;
}

/* needs to override .bill > div */
div.bill-date {
  line-height: 2em;
  float: right;
}

.odd {
  background: #EEEEEE;
}

.clearfix {
  clear: both;
}

</style>

<script id="bills-template" type="text/x-mustache-template">
<div class="bill {{parity}}">
  <h6 class="bill-number">
    <a href="#" onclick="billDetails('{{bill_id}}'); return false;">{{bill_number}}</a>
  </h6>
<div class="bill-date">{{bill_date}}</div>
<div>{{bill_title}}</div>
<div class="bill-content"></div>
</script>

<script id="bill-details-template" type="text/x-mustache-template">
<h6 class="bill-number">{{bill}}</h6>
<div class="bill-date">First introduced {{introduced_date}}</div>
<div class="bill-title">{{title}}</div>
<div class="member">Sponsored by {{sponsor}}</div>
<div class="cosponsors">Cosponsors: {{cosponsors}}</div>

<div class="bill-actions">
  <h4>Recent Actions</h4>
  {{#each actions}}
    <div class="bill-date">{{this.datetime}}</div>
    <div class="bill-action">{{this.description}}</div>
  {{/each}}
</div>

<div class="bill-versions">
  <h4>Versions</h4>
  {{#each versions}}
    <div class="bill-status">{{this.status}}</div>
    <div class="bill-title">{{this.title}}</div>
    <a href="{{this.thomas_url}}">Read Version</a>
  {{/each}}
</div>
</script>

<script type="text/javascript">
var $displayDiv;
function toggleWidth() {
  var width = parseInt($("#wrapper").css("max-width"));
  if (width <= 640) {
    $("#wrapper").css("max-width", "100%");
  } else {
    $("#wrapper").css("max-width", "640px");
  }
}

function clearDisplay () {
  $displayDiv.html("");
}

/* converts a bill.number to a bill-id used in API calls */
function formalizeBillId (str) {
  return str.replace(/\./g,"").toLowerCase();
}

function billDetails (billId) {
  $.ajax("/congress/query/bill-details/" + billId,
      { "success" : showBillDetails,
        "error" : showError });
}

function showBillDetails (details) {
  var template = Handlebars.compile($("#bill-details-template").html());
  var html = template(details);
  $("#bill-details").html(html);
}

function showHouseBills (data) {
  showBills (data, $("#house-bills"));
}

function showSenateBills (data) {
  showBills (data, $("#senate-bills"));
}

function showBills (data, $displayElement) {
  console.log (data);
  var $element;
  var bill;
  //var template = $("#bills-template").html();
  var template = Handlebars.compile($("#bills-template").html());
  var html;
  for (var i = 0; i < data.length; i++) {
    bill = data[i];
    bill.id = formalizeBillId(bill.number);
   // html = Mustache.render(template,
   html = template(
                    {parity: ["even","odd"][i%2],
                     bill_id: bill.id,
                     bill_number: bill.number,
                     bill_title: bill.title,
                     bill_date: bill.introduced_date});
    $(html).appendTo($displayElement);
  }
}

function showError (request, state, error) {
  console.log(error);
}

$().ready(function () {
  $.ajaxSetup({ error: showError });
  $displayDiv = $("#congress-display");
  $.ajax("/congress/query/recent-bills/house/introduced",
      { "success" : showHouseBills });
  $.ajax("/congress/query/recent-bills/senate/introduced",
      { "success" : showSenateBills });
  $displayDiv.tabs();
});
</script>
<div id="congress-display">
  <a href="#" id="widthToggler" onclick="toggleWidth(); return false;">Toggle Width</a>
  <div id="bill-details"></div>
  <div id="bill-display">
    <ul>
      <li class="congress-header"><a href="#bill-display-1">Recently Introduced House Bills</a></li>
      <li class="congress-header"><a href="#bill-display-2">Recently Introduced Senate Bills</a></li>
    </ul>
    <div id="bill-display-1">
      <div id="house-bills"></div>
    </div>
    <div id="bill-display-2">
      <div id="senate-bills"></div>
    </div>
  </div>
  <div class="clearfix">&nbsp;</div>
</div>
