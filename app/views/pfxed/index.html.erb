<script src="/pfxed.js"></script>
<script>

$(function () {
  function listSamples () {
    $.ajax({
      url: "/pfxed/list",
      dataType: "json",
      success: function (data) {
        console.log(data);
        $("#sample-select").html("");
        for (var i in data) {
          $("#sample-select").append(
            $("<option value='" + data[i].id + "'>" + data[i].name + "</option>")
          );
        }
        $("#sample-select").val($("#sample-id").val());
      }
    });
  }

  function newSample () {
    $.ajax({
      url: "/pfxed",
      type: "POST",
      dataType: "json",
      success: function (d) {
        listSamples();
      }
    });
  }

  function loadSample () {
    $.ajax({
      url: "/pfxed/" + $("#sample-select").val(),
      dataType: "json",
      success: function (data) {
        $("#init-function").val(data.init_function);
        $("#draw-function").val(data.draw_function);
        $("#update-function").val(data.update_function);
        $("#sample-id").val(data.id);
        $("#sample-name").val(data.name);
      }
    });

    return false;
  }

  function deleteSample () {
    $.ajax({
      url: "/pfxed/" + $("#sample-id").val(),
      type: "DELETE",
      dataType: "json",
      success: function (d) {
        listSamples();
      }
    });
  }

  function saveSample () {
    var data = {
      id: $("#sample-id").val(),
      sample: {
        init_function: $("#init-function").val(),
        draw_function: $("#draw-function").val(),
        update_function: $("#update-function").val(),
        name: $("#sample-name").val()
      }
    };

    $.ajax({
      url: "/pfxed/" + data.id,
      type: "PUT",
      dataType: "json",
      data: data,
      success: function (d) {
        listSamples();
      }
    });

    return false;
  }

  init($("#content"));

  <% if @sample %>
  $("#init-function").val("<%=j @sample.init_function %>");
  $("#draw-function").val("<%=j @sample.draw_function %>");
  $("#update-function").val("<%=j @sample.update_function %>");
  $("#sample-id").val("<%= @sample.id %>");
  $("#sample-name").val("<%= @sample.name %>");
  <% end %>

  listSamples();

  $("#save-sample").click(saveSample);
  $("#new-sample").click(newSample);
  $("#delete-sample").click(deleteSample);
  $("#sample-select").change(loadSample);

});
</script>
<style>
#ui textarea {
  height: 10em;
}
</style>

<select id="sample-select">
</select>
<input type="hidden" id="sample-id" name="id">
<input type="text" id="sample-name">
<button id="new-sample">New</button>
<button id="save-sample">Save</button>
<button id="delete-sample">Delete</button>
